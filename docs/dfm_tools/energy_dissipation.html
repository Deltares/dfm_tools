<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>dfm_tools.energy_dissipation API documentation</title>
<meta name="description" content="Created on Thu Dec
8 22:07:22 2022 â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>dfm_tools.energy_dissipation</code></h1>
</header>
<section id="section-intro">
<p>Created on Thu Dec
8 22:07:22 2022</p>
<p>@author: veenstra</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python"># -*- coding: utf-8 -*-
&#34;&#34;&#34;
Created on Thu Dec  8 22:07:22 2022

@author: veenstra
&#34;&#34;&#34;
import datetime as dt
from dask.diagnostics import ProgressBar


def compute_energy_dissipation(data_xr_map,file_ED_computed):
    &#34;&#34;&#34;
    Example:
        data_xr_map = dfmt.open_partitioned_dataset(file_nc_map,chunks={&#39;time&#39;:100}) #TODO: important to have time&gt;1, otherwise time-mean floods memory (100-200 seems optimal for GTSM 1month, but memory still floods so 1 year would probably be impossible).
        data_xr_map = data_xr_map.sel(time=slice(&#39;2014-01-01&#39;,&#39;2014-02-01&#39;))
        dfmt.compute_energy_dissipation(data_xr_map,file_ED_computed)

    
    TODO: clean up these comments
    
    Stel de bodemwrijving is (tau_x,tau_y) dan is het verlies aan energie in W/m^2
    E_loss = tau_x*u_x + tau_y*u_y
    
    Voor Chezy geldt (zo uit mijn hoofd):
    tau_x = - (rho*g)/(C^2) u_x * sqrt(u_x^2+u_y^2)
    tau_y = - (rho*g)/(C^2) u_y * sqrt(u_x^2+u_y^2)
    
    En gecombineerd
    E_loss = - (rho*g)/(C^2) * (u_x^2+u_y^2)^(3/2)
    
    Approximation: using velocities in cell centers, this is averaged but easiest
    
    E_loss(area) = sum_cells [ - (rho*g)/(C^2) * (sqrt(u_x^2+u_y^2))^3 ] * cell_area
    
    Dit is dan voor een tijdstip. Ik zou middelen over een iets langere periode zodat het de variatie over het getij verdwijnt, want de waarde is bij springtij waarschijnlijk groter.

    &#34;&#34;&#34;
    rho = 1020 #kg/m3
    g = 9.81 #m/s2
    
    attrs_ED = {&#39;long_name&#39;:&#39;energy dissipation&#39;,&#39;units&#39;:&#39;W&#39;}    
    attrs_ED_pm2 = {&#39;long_name&#39;:&#39;energy dissipation&#39;,&#39;units&#39;:&#39;W/m^2&#39;}    
    attrs_ED_areasum = {&#39;long_name&#39;:&#39;area-sum energy dissipation&#39;, &#39;units&#39;:&#39;W&#39;}
    attrs_ED_timemean = {&#39;long_name&#39;:&#39;springneaptide-mean energy dissipation&#39;, &#39;units&#39;: &#39;W&#39;}
    attrs_ED_pm2_timemean = {&#39;long_name&#39;:&#39;springneaptide-mean energy dissipation&#39;, &#39;units&#39;:&#39;Wm^2&#39;}
    
    print(&#39;&gt;&gt; compute energyloss from C/u/area: &#39;,end=&#39;&#39;)
    dtstart = dt.datetime.now()
    data_ucmag = data_xr_map.mesh2d_ucmag #m/s
    data_czs = data_xr_map.mesh2d_czs #m0.5s-1
    data_czs = data_czs.where(data_czs!=0) #0 will result in inf energyloss, so replace by nan
    data_ba = data_xr_map.mesh2d_flowelem_ba #m2
    data_xr_map[&#39;ED&#39;] = ((rho*g)/(data_czs**2) * data_ucmag**3 * data_ba).assign_attrs(attrs_ED) #(kg/m3)*(m/s2)/(m/s2)*(m3/s3)*m2 = kg/s3*m2 = W = J/s
    data_xr_map[&#39;ED_pm2&#39;] = (data_xr_map[&#39;ED&#39;] / data_ba).assign_attrs(attrs_ED_pm2) #TODO: maybe include ba instead of supplying _pm2 separately?
    
    #TODO: check da.sum(split_every=4): https://github.com/dask/dask/issues/883. Does not seem to work: &#34;TypeError: nansum() got an unexpected keyword argument &#39;split_every&#39;&#34;
    #TODO: chunking: float32 = 32 bits = 4 bytes &gt;&gt; use this to calculate chunking sizes (100-200MB per chunk is optimal)
    data_xr_map[&#39;ED_areasum&#39;] = data_xr_map.ED.sum(dim=&#39;mesh2d_nFaces&#39;).assign_attrs(attrs_ED_areasum)
    data_xr_map[&#39;ED_timemean&#39;] = data_xr_map.ED.mean(dim=&#39;time&#39;).assign_attrs(attrs_ED_timemean)
    data_xr_map[&#39;ED_pm2_timemean&#39;] = data_xr_map.ED_pm2.mean(dim=&#39;time&#39;).assign_attrs(attrs_ED_pm2_timemean)
    
    
    print(f&#39;{(dt.datetime.now()-dtstart).total_seconds():.2f} sec&#39;)
    
    data_xr_map_computed = data_xr_map[[&#39;mesh2d_flowelem_ba&#39;,&#39;ED_areasum&#39;,&#39;ED_timemean&#39;,&#39;ED_pm2_timemean&#39;]] #has to contain some var with cells (not only ED_areasum), otherwise ugrid accessor is not valid
    #data_xr_map_computed.ED_timemean.data.visualize() #does not yet work &gt;&gt; visualizes tasks of dask array
    
    print(&#39;&gt;&gt; compute and save data_xr_map_computed to netcdf: &#39;)
    with ProgressBar():
        data_xr_map_computed.ugrid.to_netcdf(file_ED_computed)
    
    data_xr_map_computed.close()
    </code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="dfm_tools.energy_dissipation.compute_energy_dissipation"><code class="name flex">
<span>def <span class="ident">compute_energy_dissipation</span></span>(<span>data_xr_map, file_ED_computed)</span>
</code></dt>
<dd>
<div class="desc"><h2 id="example">Example</h2>
<p>data_xr_map = dfmt.open_partitioned_dataset(file_nc_map,chunks={'time':100}) #TODO: important to have time&gt;1, otherwise time-mean floods memory (100-200 seems optimal for GTSM 1month, but memory still floods so 1 year would probably be impossible).
data_xr_map = data_xr_map.sel(time=slice('2014-01-01','2014-02-01'))
dfmt.compute_energy_dissipation(data_xr_map,file_ED_computed)</p>
<p>TODO: clean up these comments</p>
<p>Stel de bodemwrijving is (tau_x,tau_y) dan is het verlies aan energie in W/m^2
E_loss = tau_x<em>u_x + tau_y</em>u_y</p>
<p>Voor Chezy geldt (zo uit mijn hoofd):
tau_x = - (rho<em>g)/(C^2) u_x * sqrt(u_x^2+u_y^2)
tau_y = - (rho</em>g)/(C^2) u_y * sqrt(u_x^2+u_y^2)</p>
<p>En gecombineerd
E_loss = - (rho*g)/(C^2) * (u_x^2+u_y^2)^(3/2)</p>
<p>Approximation: using velocities in cell centers, this is averaged but easiest</p>
<p>E_loss(area) = sum_cells [ - (rho*g)/(C^2) * (sqrt(u_x^2+u_y^2))^3 ] * cell_area</p>
<p>Dit is dan voor een tijdstip. Ik zou middelen over een iets langere periode zodat het de variatie over het getij verdwijnt, want de waarde is bij springtij waarschijnlijk groter.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def compute_energy_dissipation(data_xr_map,file_ED_computed):
    &#34;&#34;&#34;
    Example:
        data_xr_map = dfmt.open_partitioned_dataset(file_nc_map,chunks={&#39;time&#39;:100}) #TODO: important to have time&gt;1, otherwise time-mean floods memory (100-200 seems optimal for GTSM 1month, but memory still floods so 1 year would probably be impossible).
        data_xr_map = data_xr_map.sel(time=slice(&#39;2014-01-01&#39;,&#39;2014-02-01&#39;))
        dfmt.compute_energy_dissipation(data_xr_map,file_ED_computed)

    
    TODO: clean up these comments
    
    Stel de bodemwrijving is (tau_x,tau_y) dan is het verlies aan energie in W/m^2
    E_loss = tau_x*u_x + tau_y*u_y
    
    Voor Chezy geldt (zo uit mijn hoofd):
    tau_x = - (rho*g)/(C^2) u_x * sqrt(u_x^2+u_y^2)
    tau_y = - (rho*g)/(C^2) u_y * sqrt(u_x^2+u_y^2)
    
    En gecombineerd
    E_loss = - (rho*g)/(C^2) * (u_x^2+u_y^2)^(3/2)
    
    Approximation: using velocities in cell centers, this is averaged but easiest
    
    E_loss(area) = sum_cells [ - (rho*g)/(C^2) * (sqrt(u_x^2+u_y^2))^3 ] * cell_area
    
    Dit is dan voor een tijdstip. Ik zou middelen over een iets langere periode zodat het de variatie over het getij verdwijnt, want de waarde is bij springtij waarschijnlijk groter.

    &#34;&#34;&#34;
    rho = 1020 #kg/m3
    g = 9.81 #m/s2
    
    attrs_ED = {&#39;long_name&#39;:&#39;energy dissipation&#39;,&#39;units&#39;:&#39;W&#39;}    
    attrs_ED_pm2 = {&#39;long_name&#39;:&#39;energy dissipation&#39;,&#39;units&#39;:&#39;W/m^2&#39;}    
    attrs_ED_areasum = {&#39;long_name&#39;:&#39;area-sum energy dissipation&#39;, &#39;units&#39;:&#39;W&#39;}
    attrs_ED_timemean = {&#39;long_name&#39;:&#39;springneaptide-mean energy dissipation&#39;, &#39;units&#39;: &#39;W&#39;}
    attrs_ED_pm2_timemean = {&#39;long_name&#39;:&#39;springneaptide-mean energy dissipation&#39;, &#39;units&#39;:&#39;Wm^2&#39;}
    
    print(&#39;&gt;&gt; compute energyloss from C/u/area: &#39;,end=&#39;&#39;)
    dtstart = dt.datetime.now()
    data_ucmag = data_xr_map.mesh2d_ucmag #m/s
    data_czs = data_xr_map.mesh2d_czs #m0.5s-1
    data_czs = data_czs.where(data_czs!=0) #0 will result in inf energyloss, so replace by nan
    data_ba = data_xr_map.mesh2d_flowelem_ba #m2
    data_xr_map[&#39;ED&#39;] = ((rho*g)/(data_czs**2) * data_ucmag**3 * data_ba).assign_attrs(attrs_ED) #(kg/m3)*(m/s2)/(m/s2)*(m3/s3)*m2 = kg/s3*m2 = W = J/s
    data_xr_map[&#39;ED_pm2&#39;] = (data_xr_map[&#39;ED&#39;] / data_ba).assign_attrs(attrs_ED_pm2) #TODO: maybe include ba instead of supplying _pm2 separately?
    
    #TODO: check da.sum(split_every=4): https://github.com/dask/dask/issues/883. Does not seem to work: &#34;TypeError: nansum() got an unexpected keyword argument &#39;split_every&#39;&#34;
    #TODO: chunking: float32 = 32 bits = 4 bytes &gt;&gt; use this to calculate chunking sizes (100-200MB per chunk is optimal)
    data_xr_map[&#39;ED_areasum&#39;] = data_xr_map.ED.sum(dim=&#39;mesh2d_nFaces&#39;).assign_attrs(attrs_ED_areasum)
    data_xr_map[&#39;ED_timemean&#39;] = data_xr_map.ED.mean(dim=&#39;time&#39;).assign_attrs(attrs_ED_timemean)
    data_xr_map[&#39;ED_pm2_timemean&#39;] = data_xr_map.ED_pm2.mean(dim=&#39;time&#39;).assign_attrs(attrs_ED_pm2_timemean)
    
    
    print(f&#39;{(dt.datetime.now()-dtstart).total_seconds():.2f} sec&#39;)
    
    data_xr_map_computed = data_xr_map[[&#39;mesh2d_flowelem_ba&#39;,&#39;ED_areasum&#39;,&#39;ED_timemean&#39;,&#39;ED_pm2_timemean&#39;]] #has to contain some var with cells (not only ED_areasum), otherwise ugrid accessor is not valid
    #data_xr_map_computed.ED_timemean.data.visualize() #does not yet work &gt;&gt; visualizes tasks of dask array
    
    print(&#39;&gt;&gt; compute and save data_xr_map_computed to netcdf: &#39;)
    with ProgressBar():
        data_xr_map_computed.ugrid.to_netcdf(file_ED_computed)
    
    data_xr_map_computed.close()</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="dfm_tools" href="index.html">dfm_tools</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="dfm_tools.energy_dissipation.compute_energy_dissipation" href="#dfm_tools.energy_dissipation.compute_energy_dissipation">compute_energy_dissipation</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>